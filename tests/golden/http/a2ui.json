{
  "$schema": "golden-trace-v1",
  "description": "A2UI (Agent-to-UI) HTTP endpoints - serves interactive canvas UI for agent responses",
  "source_files": [
    "src/canvas-host/a2ui.ts"
  ],
  "endpoints": {
    "a2ui": {
      "path": "/__moltbot__/a2ui/*",
      "description": "A2UI static assets and HTML serving",
      "methods": ["GET", "HEAD"]
    },
    "canvas_host": {
      "path": "/__moltbot__/canvas/*",
      "description": "Canvas host endpoints (handled by canvasHost)",
      "reference": "src/canvas-host/server.ts"
    },
    "canvas_ws": {
      "path": "/__moltbot/ws",
      "description": "WebSocket endpoint for canvas live reload",
      "protocol": "WebSocket"
    }
  },
  "constants": {
    "A2UI_PATH": "/__moltbot__/a2ui",
    "CANVAS_HOST_PATH": "/__moltbot__/canvas",
    "CANVAS_WS_PATH": "/__moltbot/ws"
  },
  "notes": [
    "A2UI assets located in src/canvas-host/a2ui/ or dist/canvas-host/a2ui/",
    "index.html has live reload script injected automatically",
    "WebSocket broadcasts 'reload' message for hot reload during development",
    "Mobile app bridge: Moltbot.postMessage() and Moltbot.sendUserAction()"
  ],
  "live_reload_injection": {
    "description": "Script injected before </body> in HTML responses",
    "provides": [
      "globalThis.Moltbot.postMessage(payload) - Post message to native app",
      "globalThis.Moltbot.sendUserAction(action) - Send user action with auto-generated ID",
      "globalThis.moltbotPostMessage - Alias",
      "globalThis.moltbotSendUserAction - Alias"
    ],
    "platform_handlers": {
      "ios": "window.webkit.messageHandlers.moltbotCanvasA2UIAction.postMessage()",
      "android": "window.moltbotCanvasA2UIAction.postMessage()"
    }
  },
  "scenarios": [
    {
      "name": "a2ui_index",
      "description": "Serve A2UI index.html with live reload",
      "request": {
        "method": "GET",
        "path": "/__moltbot__/a2ui/"
      },
      "response": {
        "status": 200,
        "headers": {
          "Content-Type": "text/html; charset=utf-8",
          "Cache-Control": "no-store"
        },
        "body_contains": [
          "moltbotCanvasA2UIAction",
          "Moltbot.postMessage",
          "Moltbot.sendUserAction"
        ]
      }
    },
    {
      "name": "a2ui_index_no_slash",
      "description": "Serve index.html for path without trailing slash",
      "request": {
        "method": "GET",
        "path": "/__moltbot__/a2ui"
      },
      "response": {
        "status": 200,
        "headers": { "Content-Type": "text/html; charset=utf-8" }
      }
    },
    {
      "name": "a2ui_bundle_js",
      "description": "Serve A2UI JavaScript bundle",
      "request": {
        "method": "GET",
        "path": "/__moltbot__/a2ui/a2ui.bundle.js"
      },
      "response": {
        "status": 200,
        "headers": {
          "Cache-Control": "no-store"
        }
      },
      "notes": ["Content-Type determined by MIME detection"]
    },
    {
      "name": "a2ui_static_asset",
      "description": "Serve static assets (images, CSS, etc.)",
      "request": {
        "method": "GET",
        "path": "/__moltbot__/a2ui/styles.css"
      },
      "response": {
        "status": 200,
        "headers": { "Cache-Control": "no-store" }
      }
    },
    {
      "name": "a2ui_head_request",
      "description": "HEAD request for existence check",
      "request": {
        "method": "HEAD",
        "path": "/__moltbot__/a2ui/index.html"
      },
      "response": {
        "status": 200
      }
    },
    {
      "name": "a2ui_not_found",
      "description": "Non-existent file returns 404",
      "request": {
        "method": "GET",
        "path": "/__moltbot__/a2ui/nonexistent.js"
      },
      "response": {
        "status": 404,
        "body": "not found"
      }
    },
    {
      "name": "a2ui_method_not_allowed",
      "description": "Only GET/HEAD methods allowed",
      "request": {
        "method": "POST",
        "path": "/__moltbot__/a2ui/"
      },
      "response": {
        "status": 405,
        "body": "Method Not Allowed"
      }
    },
    {
      "name": "a2ui_assets_missing",
      "description": "A2UI assets not found returns 503",
      "config_note": "When a2ui directory cannot be located",
      "request": {
        "method": "GET",
        "path": "/__moltbot__/a2ui/"
      },
      "response": {
        "status": 503,
        "body": "A2UI assets not found"
      }
    },
    {
      "name": "a2ui_path_traversal_blocked",
      "description": "Path traversal attempts blocked",
      "request": {
        "method": "GET",
        "path": "/__moltbot__/a2ui/../../../etc/passwd"
      },
      "response": {
        "status": 404,
        "body": "not found"
      }
    },
    {
      "name": "a2ui_symlink_blocked",
      "description": "Symlinks outside root are not followed",
      "request": {
        "method": "GET",
        "path": "/__moltbot__/a2ui/evil-symlink"
      },
      "response": {
        "status": 404
      },
      "notes": ["Symlinks are explicitly rejected for security"]
    },
    {
      "name": "a2ui_directory_serves_index",
      "description": "Directory paths serve index.html",
      "request": {
        "method": "GET",
        "path": "/__moltbot__/a2ui/subdir/"
      },
      "response": {
        "status": 200
      },
      "notes": ["If subdir/index.html exists"]
    },
    {
      "name": "a2ui_non_html_no_injection",
      "description": "Non-HTML files served without script injection",
      "request": {
        "method": "GET",
        "path": "/__moltbot__/a2ui/data.json"
      },
      "response": {
        "status": 200
      },
      "notes": ["Live reload script only injected in HTML responses"]
    }
  ],
  "asset_location_candidates": [
    "Adjacent to executable: <execDir>/a2ui",
    "Dist directory: dist/canvas-host/a2ui",
    "Source directory: src/canvas-host/a2ui",
    "CWD fallback: dist/canvas-host/a2ui"
  ],
  "required_files": [
    "index.html",
    "a2ui.bundle.js"
  ]
}
