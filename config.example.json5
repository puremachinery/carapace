// Carapace gateway configuration
//
// Copy this file to ~/.config/carapace/carapace.json5 and edit to taste.
// Override the path with CARAPACE_CONFIG_PATH or CARAPACE_STATE_DIR env vars.
//
// Format: JSON5 (comments, trailing commas, unquoted keys are all valid)
// Docs:   docs/protocol/config.md

{
  // --- Gateway server ---------------------------------------------------
  gateway: {
    bind: "loopback",       // "loopback" | "lan" | "tailnet" | "all" | custom IP
    port: 18789,

    auth: {
      // Uncomment one:
      // mode: "token",
      // token: "${CARAPACE_GATEWAY_TOKEN}",

      // mode: "password",
      // password: "${CARAPACE_GATEWAY_PASSWORD}",

      // Allow Tailscale-authenticated connections (requires tailscale.mode = "serve")
      // allowTailscale: true,
    },

    // tailscale: {
    //   mode: "serve",      // "off" | "serve"
    // },

    // TLS for public HTTP/WS
    // tls: {
    //   enabled: false,
    //   // certPath: "/path/to/cert.pem",
    //   // keyPath: "/path/to/key.pem",
    //   // autoGenerate: true,
    // },

    // mTLS for gateway-to-gateway connections
    // mtls: {
    //   enabled: false,
    //   // caCert: "/path/to/cluster-ca.pem",
    //   // nodeCert: "/path/to/node-cert.pem",
    //   // nodeKey: "/path/to/node-key.pem",
    //   // crlPath: "/path/to/cluster-crl.json",
    //   // requireClientCert: true,
    // },

    // Webhook / hooks API
    hooks: {
      enabled: false,
      // token: "${HOOKS_TOKEN}",
      // path: "/hooks",
      // maxBodyBytes: 262144,   // 256 KB
    },

    // OpenAI-compatible API endpoints
    // openai: {
    //   chatCompletions: true,  // POST /v1/chat/completions
    //   responses: true,        // POST /v1/responses
    // },

    // Control UI (web dashboard)
    // controlUi: {
    //   enabled: true,
    //   path: "dist/control-ui",
    // },

    // Trusted reverse proxy IPs (for X-Forwarded-For)
    // trustedProxies: ["127.0.0.1", "::1"],

    // Outbound remote gateway connections
    // remote: {
    //   enabled: false,
    //   // authToken: "${CARAPACE_GATEWAY_TOKEN}",
    //   // autoReconnect: true,
    //   // reconnectIntervalMs: 30000,
    //   // maxReconnectAttempts: 10,
    //   // gateways: [
    //   //   {
    //   //     name: "home",
    //   //     url: "wss://home.example.com:18789/ws",
    //   //     // fingerprint: "AB:CD:EF:01:23:45:...",
    //   //     autoConnect: true,
    //   //   },
    //   //   {
    //   //     name: "via-bastion",
    //   //     url: "wss://gateway.internal:18789/ws",
    //   //     autoConnect: true,
    //   //     ssh: {
    //   //       host: "bastion.example.com",
    //   //       port: 22,
    //   //       user: "deployer",
    //   //       remotePort: 18789,
    //   //     },
    //   //   },
    //   // ],
    // },
  },

  // --- LLM provider -----------------------------------------------------
  anthropic: {
    apiKey: "${ANTHROPIC_API_KEY}",   // export ANTHROPIC_API_KEY="sk-ant-..."
    // baseUrl: "https://api.anthropic.com",  // override with ANTHROPIC_BASE_URL env var
  },

  // --- OpenAI / OpenAI-compatible provider ----------------------------------
  // openai: {
  //   apiKey: "${OPENAI_API_KEY}",
  //   // baseUrl: "https://api.openai.com",       // default
  //   // For local servers (vLLM, llama.cpp, LM Studio, MLX):
  //   // baseUrl: "http://localhost:8000/v1",
  //   // apiKey: "unused",                         // required but ignored by most local servers
  // },

  // --- Ollama provider ------------------------------------------------------
  // ollama: {
  //   // baseUrl: "http://localhost:11434",       // default
  //   // apiKey: "optional-key",                  // for remote instances with auth
  // },

  // --- AWS Bedrock provider ------------------------------------------------
  // bedrock: {
  //   region: "us-east-1",                          // or AWS_REGION / AWS_DEFAULT_REGION
  //   accessKeyId: "${AWS_ACCESS_KEY_ID}",
  //   secretAccessKey: "${AWS_SECRET_ACCESS_KEY}",
  //   // sessionToken: "${AWS_SESSION_TOKEN}",      // for temporary credentials
  //   // enabled: false,                            // explicit kill switch
  // },

  // --- Signal channel (via signal-cli REST API) ------------------------------
  // signal: {
  //   baseUrl: "http://localhost:8080",           // signal-cli-rest-api address
  //   phoneNumber: "+15551234567",                // registered Signal number
  //   // enabled: false,                          // set to false to disable without removing config
  // },

  // --- Telegram channel (via Bot API) --------------------------------------
  // telegram: {
  //   botToken: "${TELEGRAM_BOT_TOKEN}",          // Telegram bot token
  //   // webhookSecret: "${TELEGRAM_WEBHOOK_SECRET}", // required for inbound webhooks
  //   // baseUrl: "https://api.telegram.org",     // override API base URL
  //   // enabled: false,                          // set to false to disable without removing config
  // },

  // --- Discord channel (via REST API) --------------------------------------
  // discord: {
  //   botToken: "${DISCORD_BOT_TOKEN}",           // Discord bot token
  //   // gatewayEnabled: true,                    // connect to Discord gateway for inbound messages
  //   // gatewayIntents: 37377,                   // intents bitmask (includes MESSAGE_CONTENT)
  //   // gatewayUrl: "wss://gateway.discord.gg/?v=10&encoding=json",
  //   // baseUrl: "https://discord.com/api/v10",  // override API base URL
  //   // enabled: false,                          // set to false to disable without removing config
  // },

  // --- Slack channel (via Web API) -----------------------------------------
  // slack: {
  //   botToken: "${SLACK_BOT_TOKEN}",             // Slack bot token (xoxb-...)
  //   // signingSecret: "${SLACK_SIGNING_SECRET}", // validate Events API signatures
  //   // baseUrl: "https://slack.com/api",        // override API base URL
  //   // enabled: false,                          // set to false to disable without removing config
  // },

  // --- Agents -----------------------------------------------------------
  // agents: {
  //   list: [
  //     {
  //       id: "default",
  //       default: true,
  //       identity: {
  //         name: "Carapace",
  //         description: "A helpful assistant",
  //       },
  //     },
  //   ],
  // },

  // --- Sessions ---------------------------------------------------------
  // sessions: {
  //   retention: {
  //     enabled: true,         // auto-delete old sessions (default: true)
  //     days: 30,              // delete sessions older than N days (default: 30)
  //     intervalHours: 6,      // cleanup cadence in hours (default: 6)
  //   },
  // },

  // --- Usage tracking ---------------------------------------------------
  // usage: {
  //   pricing: {
  //     // Default pricing (USD per million tokens).
  //     default: { inputCostPerMTok: 3.0, outputCostPerMTok: 15.0 },
  //     // Override pricing by model name (matchType: "contains" | "exact").
  //     overrides: [
  //       { match: "gpt-4o", matchType: "contains", inputCostPerMTok: 5.0, outputCostPerMTok: 15.0 },
  //     ],
  //   },
  // },

  // --- Logging ----------------------------------------------------------
  // logging: {
  //   level: "info",          // "trace" | "debug" | "info" | "warn" | "error"
  //   format: "pretty",       // "pretty" | "json"
  // },

  // --- Venice AI provider ------------------------------------------------
  // venice: {
  //   apiKey: "${VENICE_API_KEY}",   // export VENICE_API_KEY="..."
  //   // baseUrl: "https://api.venice.ai/api",  // override with VENICE_BASE_URL env var
  // },

  // --- Inbound message classifier ----------------------------------------
  // classifier: {
  //   enabled: true,
  //   mode: "warn",              // "off" | "warn" | "block"
  //   model: "gpt-4o-mini",     // cheap/fast model for classification
  //   blockThreshold: 0.8,      // confidence threshold (0.0â€“1.0)
  // },

  // --- Plugins (WASM) ---------------------------------------------------
  // plugins: {
  //   enabled: true,
  //   load: {
  //     paths: ["/path/to/plugins"],
  //   },
  // },
}
